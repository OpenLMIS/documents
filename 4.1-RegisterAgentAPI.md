# Create virtual facility API

### Communication Type

- HTTP Post, to OpenLMIS
 
### Authentication

- Authentication token (Base64 encrypted string containing username:password)

### Parameters

- agentCode - Mandatory
- agentName - Mandatory
- parentFacilityCode - Mandatory
- phoneNumber - Optional
- Active - {True | False} - Optional (By default will be considered as "active")

### Return

#### Success
{  
   "Success": "Success message"  
} 

### Error scenarios

#### 1) *Invalid authentication*  
**Response**:    
{  
   "error": "Authentication Failed"  
}   
**Description**: This error can be caused by an incorrect API username, an incorrect API password, or an invalid API signature. Make sure that all three of these values are correct.

#### 2) *Any mandatory field missing*
**Response**:  
{    
   "error": "Mandatory field Missing"    
}    
**Description**: This error will occur if any of the manadatory field (agentCode, agentName or baseFacilityCode) is either null or tag is missing.

#### 3) *Invalid parentFacilityCode*
**Response**:  
{        
   "error": "Invalid FacilityCode"      
}  
  
**Description**: parentfacilityCode is the Code of facility registered in OpenLMIS and sent to CommTrack as part of "facilityMasterFeed". This error will occur if:-  
a) parentfacilityCode in the API does not exist in OpenLMIS.  
b) parentfacilityCode in the API is a virtual facility registered earlier in OpenLMIS. As a CHW (virtual facility) cannot be mapped to another CHW, OpenLMIS will check that parentFacilityCode should not be a virtual facility.

#### 4) *agentCode already exists*
**Response**:  
{        
   "error": "Agent already registered"      
}   
**Description**: This error will occur if "createVirtualFacility" request is received with a agentCode that is already registered in OpenLMIS. An agent can be updated by "updatevirtualFacility" API.

#### 5) *Invalid value for "Active" field*
**Response**:  
{        
   "error": "Bad request"      
}   
**Description**: The "Active" flag in API will accept only two values : {True | False}, being an optional field in API it can be kept null. However, OpenLMIS will check for valid values if it is not null.

#### 6) *Malformed JSON*
**Response**:   
{          
   "error": "Bad request"        
}   
**Description**: This error will occur if there is some formatting error in JSON.

#### 7) *Unrecognized field*
**Response**:  
{        
   "error": "Bad request"      
}  
**Description**: This error will occur if any unrecognized field (apart from fields mentioned in parameters) is sent as part of API.

#### 8) *Internal server error*
**Response**:  
{        
   "error": "Something went wrong"      
}  
**Description**: This error will occur if request can not be processed due to some internal server error.

### Notes

CommTrack will use this API to notify OpenLMIS everytime a new CHW is created. OpenLMIS will store agentCode as an identifier for this CHW/virtual facility and use it to match up successive reports coming from CHW.

### JSON: Coming soon

